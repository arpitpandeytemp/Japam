<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>राधे राधे माला जप काउंटर</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
        }
        
        :root {
            --primary-gold: #FFD700;
            --secondary-gold: #FFA000;
            --dark-bg: #1a237e;
            --medium-bg: #4a148c;
            --light-bg: #880e4f;
            --text-light: #e0e0e0;
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(255, 255, 255, 0.15);
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg), var(--medium-bg), var(--light-bg));
            color: white;
            min-height: 100vh;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.5;
        }

        /* Main Container - Mobile First */
        .container {
            width: 100%;
            max-width: 100%;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 16px;
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Header Section */
        .matra {
            font-size: 0.9rem;
            color: var(--primary-gold);
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
            line-height: 1.4;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--primary-gold);
            text-align: center;
            margin-bottom: 4px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .subtitle {
            font-size: 0.95rem;
            color: var(--text-light);
            text-align: center;
        }

        /* Counter Section */
        .counter-section {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .counter-display {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--primary-gold);
            text-align: center;
            margin: 8px 0;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mantra-display {
            font-size: 1.5rem;
            color: var(--primary-gold);
            font-weight: bold;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Mala Button */
        .mala-button {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
            border: none;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
        }

        .mala-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .mala-button i {
            font-size: 2.8rem;
            color: #5D4037;
        }

        /* Controls */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 14px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Stats */
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 12px;
            padding: 16px 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-gold);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* Install Button */
        .install-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .install-btn:active {
            transform: translateY(1px);
        }

        /* Footer */
        footer {
            margin-top: 16px;
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: center;
        }

        /* Animations */
        .pulse {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .completion-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: var(--primary-gold);
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1.2rem;
            z-index: 1000;
            animation: fadeInOut 3s ease;
            text-align: center;
            max-width: 85%;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Tablet Styles */
        @media (min-width: 768px) {
            .container {
                max-width: 500px;
                padding: 24px 20px;
                gap: 20px;
            }

            .matra {
                font-size: 1rem;
                padding: 14px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header .subtitle {
                font-size: 1.1rem;
            }

            .counter-display {
                font-size: 4rem;
            }

            .mantra-display {
                font-size: 1.7rem;
            }

            .mala-button {
                width: 140px;
                height: 140px;
            }

            .mala-button i {
                font-size: 3.2rem;
            }

            .controls {
                flex-direction: row;
                gap: 12px;
            }

            .control-btn {
                padding: 12px 16px;
            }

            .stats {
                padding: 18px 14px;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.85rem;
            }
        }

        /* Desktop Styles */
        @media (min-width: 1024px) {
            body {
                padding: 24px;
            }

            .container {
                max-width: 450px;
                padding: 28px 24px;
            }

            .mala-button {
                transition: all 0.3s ease;
            }

            .mala-button:hover {
                transform: scale(1.05);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
            }

            .mala-button:active {
                transform: scale(0.95);
            }

            .control-btn {
                transition: all 0.3s ease;
            }

            .control-btn:hover {
                background: rgba(255, 255, 255, 0.25);
                transform: translateY(-2px);
            }

            .install-btn {
                transition: all 0.3s ease;
            }

            .install-btn:hover {
                transform: translateY(-2px);
            }
        }

        /* Large Desktop Styles - 1000px+ with 800px width */
        @media (min-width: 1000px) {
            .container {
                max-width: 800px;
                padding: 35px 40px;
                gap: 25px;
            }

            /* New Layout for Large Screens */
            .app-layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                align-items: center;
            }

            .left-section {
                display: flex;
                flex-direction: column;
                gap: 25px;
            }

            .right-section {
                display: flex;
                flex-direction: column;
                gap: 25px;
            }

            /* Header adjustments */
            .matra {
                font-size: 1.1rem;
                padding: 16px;
                grid-column: 1 / -1;
            }

            .header {
                grid-column: 1 / -1;
                text-align: center;
            }

            .header h1 {
                font-size: 2.8rem;
                margin-bottom: 8px;
            }

            .header .subtitle {
                font-size: 1.3rem;
            }

            /* Counter section adjustments */
            .counter-section {
                padding: 30px;
                border-radius: 20px;
            }

            .counter-display {
                font-size: 5rem;
                min-height: 100px;
            }

            .mantra-display {
                font-size: 2.2rem;
                min-height: 50px;
            }

            /* Mala button adjustments */
            .mala-button {
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }

            .mala-button i {
                font-size: 4.5rem;
            }

            /* Controls adjustments */
            .controls {
                flex-direction: row;
                justify-content: center;
                gap: 20px;
            }

            .control-btn {
                padding: 16px 24px;
                font-size: 1.1rem;
                min-width: 150px;
            }

            /* Stats adjustments */
            .stats-container {
                gap: 20px;
            }

            .stats {
                padding: 22px 18px;
                border-radius: 16px;
                gap: 12px;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .stat-label {
                font-size: 0.95rem;
            }

            /* Install button adjustments */
            .install-btn {
                padding: 16px 24px;
                font-size: 1.1rem;
                grid-column: 1 / -1;
                justify-self: center;
                min-width: 250px;
            }

            /* Footer adjustments */
            footer {
                font-size: 1rem;
                margin-top: 25px;
                grid-column: 1 / -1;
            }
        }

        /* Extra Large Desktop Styles */
        @media (min-width: 1400px) {
            .container {
                max-width: 850px;
                padding: 40px 45px;
            }

            .counter-display {
                font-size: 5.5rem;
            }

            .mala-button {
                width: 200px;
                height: 200px;
            }

            .mala-button i {
                font-size: 5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Matra Section -->
        <div class="matra">
            जय श्री कृष्ण चैतन्य, प्रभु नित्यानंद, श्री अद्वैत, गदाधर, श्रीवासादि गौर भक्तवृंद।
        </div>
        
        <!-- Header -->
        <div class="header">
            <h1>राधे राधे माला जप</h1>
            <p class="subtitle">श्री कृष्ण की भक्ति के लिए आपका डिजिटल माला</p>
        </div>

        <!-- Main Content Layout for Large Screens -->
        <div class="app-layout">
            <!-- Left Section -->
            <div class="left-section">
                <!-- Counter Section -->
                <div class="counter-section">
                    <div class="counter-display" id="counter">0</div>
                    <div class="mantra-display" id="mantraDisplay">राधे राधे</div>
                </div>
                
                <!-- Mala Button -->
                <button class="mala-button" id="japButton">
                    <i class="fas fa-praying-hands"></i>
                </button>
            </div>

            <!-- Right Section -->
            <div class="right-section">
                <!-- Controls -->
                <div class="controls">
                    <button class="control-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> रीसेट
                    </button>
                    <button class="control-btn" id="soundToggle">
                        <i class="fas fa-volume-up"></i> ध्वनि
                    </button>
                </div>
                
                <!-- Stats Container -->
                <div class="stats-container">
                    <!-- Daily/Weekly/Total Stats -->
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-value" id="todayCount">0</span>
                            <span class="stat-label">आज</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="weekCount">0</span>
                            <span class="stat-label">इस सप्ताह</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalCount">0</span>
                            <span class="stat-label">कुल</span>
                        </div>
                    </div>
                    
                    <!-- Mala Stats -->
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-value" id="malaCount">0</span>
                            <span class="stat-label">माला</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="todayMalaCount">0</span>
                            <span class="stat-label">आज की माला</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="weekMalaCount">0</span>
                            <span class="stat-label">सप्ताह की माला</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Install Button -->
        <button class="install-btn" id="installBtn">
            <i class="fas fa-download"></i> ऐप इंस्टॉल करें
        </button>
    </div>
    
    <!-- Footer -->
    <footer>
        प्रेम और शांति के साथ - राधे राधे
    </footer>

    <script>
        // DOM Elements
        const counterElement = document.getElementById('counter');
        const mantraDisplay = document.getElementById('mantraDisplay');
        const japButton = document.getElementById('japButton');
        const resetBtn = document.getElementById('resetBtn');
        const soundToggle = document.getElementById('soundToggle');
        const todayCountElement = document.getElementById('todayCount');
        const weekCountElement = document.getElementById('weekCount');
        const totalCountElement = document.getElementById('totalCount');
        const malaCountElement = document.getElementById('malaCount');
        const todayMalaCountElement = document.getElementById('todayMalaCount');
        const weekMalaCountElement = document.getElementById('weekMalaCount');
        const installBtn = document.getElementById('installBtn');
        
        // App State
        let count = parseInt(localStorage.getItem('japCount')) || 0;
        let todayCount = parseInt(localStorage.getItem('todayCount')) || 0;
        let weekCount = parseInt(localStorage.getItem('weekCount')) || 0;
        let totalCount = parseInt(localStorage.getItem('totalCount')) || 0;
        let malaCount = parseInt(localStorage.getItem('malaCount')) || 0;
        let todayMalaCount = parseInt(localStorage.getItem('todayMalaCount')) || 0;
        let weekMalaCount = parseInt(localStorage.getItem('weekMalaCount')) || 0;
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        let lastResetDate = localStorage.getItem('lastResetDate') || getTodayDateString();
        let lastResetWeek = localStorage.getItem('lastResetWeek') || getCurrentWeek();
        
        // Audio Context for Sound
        let audioContext;
        let bellSoundBuffer;
        
        // Initialize
        initializeAudio();
        checkAndResetCounters();
        updateDisplay();
        updateStats();
        updateSoundButton();
        
        // Event Listeners
        japButton.addEventListener('click', incrementCount);
        resetBtn.addEventListener('click', resetCount);
        soundToggle.addEventListener('click', toggleSound);
        
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
        });
        
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });
        
        // Functions
        function updateSoundButton() {
            const icon = soundToggle.querySelector('i');
            if (soundEnabled) {
                icon.className = 'fas fa-volume-up';
                soundToggle.innerHTML = '<i class="fas fa-volume-up"></i> ध्वनि';
            } else {
                icon.className = 'fas fa-volume-mute';
                soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i> ध्वनि';
            }
        }
        
        async function initializeAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create a simple bell sound
                const duration = 1;
                const sampleRate = audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                
                const buffer = audioContext.createBuffer(1, frameCount, sampleRate);
                const channelData = buffer.getChannelData(0);
                
                // Generate bell sound
                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    // Bell-like sound with multiple harmonics
                    channelData[i] = 
                        0.5 * Math.sin(2 * Math.PI * 523.25 * t) * Math.exp(-4 * t) + // C5
                        0.3 * Math.sin(2 * Math.PI * 783.99 * t) * Math.exp(-4 * t) + // G5
                        0.2 * Math.sin(2 * Math.PI * 1046.5 * t) * Math.exp(-4 * t);  // C6
                }
                
                bellSoundBuffer = buffer;
            } catch (e) {
                console.log("Audio initialization failed:", e);
            }
        }
        
        function playBellSound() {
            if (!soundEnabled || !audioContext || !bellSoundBuffer) return;
            
            try {
                // Resume audio context if it's suspended (common on mobile)
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const source = audioContext.createBufferSource();
                source.buffer = bellSoundBuffer;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0.5;
                
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                source.start();
            } catch (e) {
                console.log("Sound playback failed:", e);
            }
        }
        
        function incrementCount() {
            // Check if we need to reset daily/weekly counters
            checkAndResetCounters();
            
            count++;
            todayCount++;
            weekCount++;
            totalCount++;
            
            // Update mantra display with animation
            mantraDisplay.textContent = "राधे राधे";
            mantraDisplay.style.opacity = 0;
            setTimeout(() => {
                mantraDisplay.style.opacity = 1;
            }, 100);
            
            // Check for mala completion (108 counts)
            if (count % 108 === 0) {
                malaCount++;
                todayMalaCount++;
                weekMalaCount++;
                showCompletionMessage();
            }
            
            updateDisplay();
            updateStats();
            saveToStorage();
            
            // Add animation
            counterElement.classList.add('pulse');
            setTimeout(() => {
                counterElement.classList.remove('pulse');
            }, 500);
            
            // Play sound
            playBellSound();
        }
        
        function resetCount() {
            count = 0;
            updateDisplay();
            saveToStorage();
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            updateSoundButton();
            localStorage.setItem('soundEnabled', soundEnabled);
        }
        
        function updateDisplay() {
            counterElement.textContent = count;
        }
        
        function updateStats() {
            todayCountElement.textContent = todayCount;
            weekCountElement.textContent = weekCount;
            totalCountElement.textContent = totalCount;
            malaCountElement.textContent = malaCount;
            todayMalaCountElement.textContent = todayMalaCount;
            weekMalaCountElement.textContent = weekMalaCount;
        }
        
        function saveToStorage() {
            localStorage.setItem('japCount', count);
            localStorage.setItem('todayCount', todayCount);
            localStorage.setItem('weekCount', weekCount);
            localStorage.setItem('totalCount', totalCount);
            localStorage.setItem('malaCount', malaCount);
            localStorage.setItem('todayMalaCount', todayMalaCount);
            localStorage.setItem('weekMalaCount', weekMalaCount);
            localStorage.setItem('lastResetDate', lastResetDate);
            localStorage.setItem('lastResetWeek', lastResetWeek);
        }
        
        function checkAndResetCounters() {
            const today = getTodayDateString();
            const currentWeek = getCurrentWeek();
            
            // Reset daily count if it's a new day
            if (today !== lastResetDate) {
                todayCount = 0;
                todayMalaCount = 0;
                lastResetDate = today;
                updateStats();
            }
            
            // Reset weekly count if it's a new week
            if (currentWeek !== lastResetWeek) {
                weekCount = 0;
                weekMalaCount = 0;
                lastResetWeek = currentWeek;
                updateStats();
            }
            
            // Save updated values
            saveToStorage();
        }
        
        function getTodayDateString() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
        }
        
        function getCurrentWeek() {
            const today = new Date();
            const firstDayOfYear = new Date(today.getFullYear(), 0, 1);
            const pastDaysOfYear = (today - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }
        
        function showCompletionMessage() {
            const message = document.createElement('div');
            message.className = 'completion-message';
            message.textContent = 'ॐ - एक माला पूर्ण हुई! राधे राधे';
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                if (document.body.contains(message)) {
                    document.body.removeChild(message);
                }
            }, 3000);
        }
    </script>
</body>
</html>
